<!-- fashion-shop/templates/product_detail.html -->
{% extends "base.html" %}

{% block title %}{{ product.name }} - Fashion Shop{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-lg p-8 md:p-12 border border-gray-200 flex flex-col md:flex-row gap-8 md:gap-12">
    <!-- Product Image -->
    <div class="w-full md:w-1/2 flex justify-center items-center overflow-hidden rounded-lg">
        <img src="{{ url_for('static', filename='images/products/' + (product.image_filename or 'placeholder.jpg')) }}" alt="{{ product.name }}" class="max-w-full h-auto object-contain rounded-lg shadow-md">
    </div>

    <!-- Product Info -->
    <div class="w-full md:w-1/2">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-3">{{ product.name }}</h1>
        <p class="text-indigo-600 text-2xl font-bold mb-4">${{ "%.2f"|format(product.price) }}</p>
        <p class="text-gray-600 text-lg mb-6 leading-relaxed">{{ product.description }}</p>

        <div class="mb-6">
            <p class="text-gray-700 font-semibold mb-2">Category: <span class="font-normal text-indigo-500">{{ product.category.name if product.category else 'Uncategorized' }}</span></p>
            <p class="text-gray-700 font-semibold mb-2">Availability:
                <span class="font-normal {% if product.stock > 0 and product.available %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if product.stock > 0 and product.available %}In Stock ({{ product.stock }} items){% else %}Out of Stock{% endif %}
                </span>
            </p>
            <!-- Add more details like size, color options here if you extend your model -->
            <div class="mt-4">
                <label for="quantity" class="block text-gray-700 text-sm font-bold mb-2">Quantity:</label>
                <input type="number" id="quantity-{{ product.id }}" value="1" min="1" max="{{ product.stock }}"
                       class="shadow appearance-none border rounded w-24 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-indigo-500">
            </div>
        </div>

        <!-- fashion-shop/templates/product_detail.html (snippet for Add to Cart button) -->
    {# NEW: Form for Add to Cart #}
    <!-- fashion-shop/templates/product_detail.html (snippet for Add to Cart form) -->
<form method="POST" action="{{ url_for('add_to_cart_submit') }}" class="inline-block">
    {{ form.csrf_token }} {# ADDED: CSRF Token #}
    <input type="hidden" name="product_id" value="{{ product.id }}">
    <input type="hidden" name="quantity" id="form-quantity" value="1"> {# This will be updated by JS if user changes quantity #}
    <button
        type="submit"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2 text-lg"
        {% if product.stock == 0 or not product.available %}disabled{% endif %}
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.5 12 5 12h14a1 1 0 000-2H5.414l-.914-.914A1 1 0 004 10V8a1 1 0 011-1h11.17l-1.359-4.072A1 1 0 0014 2H5a1 1 0 00-.914.586L2 7.586V1a1 1 0 00-2 0zm7 10a2 2 0 11-4 0 2 2 0 014 0zM17 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        Add to Cart
    </button>
</form>
    <script>
        // Update the hidden quantity input when the visible quantity input changes
        document.getElementById('quantity').addEventListener('change', function() {
            document.getElementById('form-quantity').value = this.value;
        });
    </script>

        {% if product.stock == 0 or not product.available %}
            <p class="text-red-500 text-sm mt-3">This item is currently out of stock.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
