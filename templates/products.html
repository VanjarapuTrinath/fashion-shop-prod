<!-- fashion-shop/templates/products.html -->
{% extends "base.html" %}

{% block title %}Products - Fashion Shop{% endblock %}

{% block content %}
<h1 class="text-4xl font-extrabold text-gray-900 mb-8 text-center">Our Collection</h1>

<div class="flex flex-col md:flex-row gap-8">
    <!-- Sidebar for Categories -->
    <aside class="w-full md:w-1/4 bg-white p-6 rounded-xl shadow-lg border border-gray-200 h-fit sticky top-24">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Categories</h3>
        <ul>
            <li class="mb-2">
                <a href="{{ url_for('products') }}" class="block p-2 rounded-md {% if not current_category %}bg-indigo-100 text-indigo-700 font-semibold{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors duration-200">All Products</a>
            </li>
            {% for category in categories %}
            <li class="mb-2">
                <a href="{{ url_for('products_by_category', slug=category.slug) }}" class="block p-2 rounded-md {% if current_category and current_category.id == category.id %}bg-indigo-100 text-indigo-700 font-semibold{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors duration-200">
                    {{ category.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </aside>

    <!-- Product Grid -->
    <div class="w-full md:w-3/4">
        {% if products %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for product in products %}
            <div class="bg-white rounded-xl shadow-lg overflow-hidden transform transition duration-300 hover:scale-105 hover:shadow-2xl border border-gray-200">
                {# REMOVED: The <a> tag that wrapped the image, making it non-clickable #}
                <img src="{{ url_for('static', filename='images/products/' + (product.image_filename or 'placeholder.jpg')) }}" alt="{{ product.name }}" class="w-full h-64 object-cover object-center">
                <div class="p-5">
                    <h3 class="text-xl font-semibold text-gray-900 mb-2 truncate">
                        <a href="{{ url_for('product_detail', slug=product.slug) }}" class="hover:text-indigo-600">{{ product.name }}</a>
                    </h3>
                    <p class="text-gray-600 text-sm mb-3">{{ product.category.name if product.category else 'Uncategorized' }}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-2xl font-bold text-indigo-700">${{ "%.2f"|format(product.price) }}</span>
                        {# Form-based Add to Cart button #}
                        <form method="POST" action="{{ url_for('add_to_cart') }}" class="inline-block">
                            {{ form.csrf_token }}
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <input type="hidden" name="quantity" value="1">
                            <button
                                type="submit"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-full text-sm font-semibold transition-colors duration-200 flex items-center gap-2"
                                {% if product.stock == 0 or not product.available %}disabled{% endif %}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.5 12 5 12h14a1 1 0 000-2H5.414l-.914-.914A1 1 0 004 10V8a1 1 0 011-1h11.17l-1.359-4.072A1 1 0 0014 2H5a1 1 0 00-.914.586L2 7.586V1a1 1 0 00-2 0zm7 10a2 2 0 11-4 0 2 2 0 014 0zM17 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                Add to Cart
                            </button>
                        </form>
                    </div>
                    {% if product.stock == 0 or not product.available %}
                        <p class="text-red-500 text-xs mt-2">Out of Stock</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-center text-gray-600 text-lg py-10">No products found in this category.</p>
        {% endif %}
    </div>
</div>
{% endblock %}